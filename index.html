<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡ç­†åŠƒæŸ¥æ‰¾å™¨</title>
    
    <!-- å¼•å…¥ jQuery (HanziLookupJS çš„ DrawingBoard éœ€è¦) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- å¼•å…¥ HanziLookupJS åº« -->
    <script src="hanzilookup.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: "Microsoft YaHei", "å¾®è»Ÿé›…é»‘", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 32px;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        /* è¼¸å…¥å€åŸŸæ¨£å¼ */
        .input-section {
            min-height: 400px;
        }
        .input-mode {
            margin-bottom: 15px;
        }
        .mode-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .mode-tab {
            padding: 8px 16px;
            background: #e9ecef;
            border: 2px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .mode-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .mode-tab:hover {
            background: #5568d3;
            color: white;
        }
        .input-content {
            display: none;
        }
        .input-content.active {
            display: block;
        }
        #textInput {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            border: 3px solid #667eea;
            border-radius: 8px;
            font-family: "Microsoft YaHei", sans-serif;
            box-sizing: border-box;
        }
        #drawingBoard {
            border: 3px solid #667eea;
            background: white;
            border-radius: 10px;
            width: 100%;
            height: 300px;
        }
        #drawingBoard canvas {
            border-radius: 10px;
        }
        .handwriting-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .handwriting-candidates {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            min-height: 60px;
            text-align: center;
        }
        .candidate-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            background: #e7f5ff;
            border: 2px solid #4dabf7;
            border-radius: 5px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.2s;
        }
        .candidate-item:hover {
            background: #4dabf7;
            color: white;
            transform: scale(1.1);
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-family: "Microsoft YaHei", sans-serif;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-clear {
            background: #ff6b6b;
            color: white;
        }
        .btn-clear:hover {
            background: #ee5a52;
            transform: translateY(-2px);
        }
        .btn-undo {
            background: #ffa94d;
            color: white;
        }
        .btn-undo:hover {
            background: #ff922b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-undo:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* è¼¸å‡ºå€åŸŸæ¨£å¼ */
        .output-section {
            min-height: 400px;
        }
        #outputResult {
            width: 100%;
            min-height: 350px;
            padding: 20px;
            font-size: 20px;
            border: 3px solid #667eea;
            border-radius: 8px;
            background: white;
            font-family: "Microsoft YaHei", sans-serif;
            line-height: 2;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            box-sizing: border-box;
        }
        .output-char {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .char-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .char-uiojk {
            font-size: 18px;
            color: #666;
            margin-bottom: 5px;
        }
        .char-strokes {
            font-size: 32px;
            color: #333;
            font-weight: bold;
        }
        .status {
            text-align: center;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 14px;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœï¸ ä¸­æ–‡ç­†åŠƒæŸ¥æ‰¾å™¨</h1>
        
        <div id="status" class="status loading">æ­£åœ¨è¼‰å…¥æ•¸æ“š...</div>
        
        <div class="main-content">
            <!-- è¼¸å…¥å€åŸŸ -->
            <div class="section input-section">
                <div class="section-title">ğŸ“ è¼¸å…¥å€åŸŸ</div>
                
                <div class="input-mode">
                    <div class="mode-tabs">
                        <div class="mode-tab active" data-mode="keyboard" onclick="switchMode(event, 'keyboard')">âŒ¨ï¸ éµç›¤è¼¸å…¥</div>
                        <div class="mode-tab" data-mode="handwriting" onclick="switchMode(event, 'handwriting')">âœï¸ æ‰‹å¯«è¼¸å…¥</div>
                    </div>
                    
                    <!-- éµç›¤è¼¸å…¥æ¨¡å¼ -->
                    <div id="keyboardMode" class="input-content active">
                        <input type="text" id="textInput" placeholder="è«‹è¼¸å…¥ä¸­æ–‡å­—..." autocomplete="off">
                        <div style="margin-top: 10px; color: #666; font-size: 14px;">
                            ğŸ’¡ æç¤ºï¼šç›´æ¥è¼¸å…¥ä¸­æ–‡å­—ï¼Œçµæœæœƒè‡ªå‹•é¡¯ç¤ºåœ¨å³å´
                        </div>
                    </div>
                    
                    <!-- æ‰‹å¯«è¼¸å…¥æ¨¡å¼ -->
                    <div id="handwritingMode" class="input-content">
                        <div id="drawingBoard"></div>
                        <div class="handwriting-controls">
                            <button class="btn-undo" onclick="undoStroke()">é‡åš</button>
                            <button class="btn-clear" onclick="clearBoard()">æ¸…é™¤</button>
                        </div>
                        <div id="handwritingCandidates" class="handwriting-candidates">
                            <div style="color: #666; font-size: 14px; margin-bottom: 8px;">è­˜åˆ¥çµæœï¼ˆé»æ“Šé¸æ“‡ï¼‰ï¼š</div>
                            <div id="candidatesList" style="min-height: 50px;">
                                <div style="color: #999; padding: 20px; text-align: center;">è«‹åœ¨ä¸Šæ–¹æ›¸å¯«ï¼Œè­˜åˆ¥çµæœæœƒå³æ™‚é¡¯ç¤º</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- è¼¸å‡ºå€åŸŸ -->
            <div class="section output-section">
                <div class="section-title">ğŸ“Š ç­†åŠƒçµæœ</div>
                <div id="outputResult">è«‹åœ¨å·¦å´è¼¸å…¥ä¸­æ–‡å­—...</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let charMap = {}; // å­—ç¬¦åˆ°UIOJKçš„æ˜ å°„
        let drawingBoard = null;
        let matcher = null;
        let dataLoaded = false;
        let hanzilookupLoaded = false;
        
        // UIOJKåˆ°ç­†åŠƒçš„è½‰æ›æ˜ å°„
        function uiojkToStroke(c) {
            switch (c.toLowerCase()) {
                case 'u': return 'ä¸€';
                case 'i': return 'ä¸¨';
                case 'o': return 'ä¸¿';
                case 'j': return 'ä¸¶';
                case 'k': return 'ãƒ•';
                default: return c;
            }
        }
        
        // è½‰æ›UIOJKå­—ç¬¦ä¸²ç‚ºç­†åŠƒå­—ç¬¦ä¸²
        function convertUIOJKToStrokes(uiojk) {
            let result = '';
            for (let c of uiojk) {
                if (c !== ' ' && c !== '\t') {
                    result += uiojkToStroke(c);
                }
            }
            return result;
        }
        
        // å¾GitHubè¼‰å…¥Zi-Ma-Biao.txt
        async function loadCharData() {
            const statusDiv = document.getElementById('status');
            try {
                statusDiv.textContent = 'æ­£åœ¨å¾GitHubè¼‰å…¥å­—ç¢¼è¡¨...';
                statusDiv.className = 'status loading';
                
                // ä½¿ç”¨ raw URL
                const url = 'https://raw.githubusercontent.com/Yamazaki427858/ChineseStrokeIME/ChineseStrokeIME/SourceCode/%E5%AD%97%E7%A2%BC/Zi-Ma-Biao.txt';
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('ç„¡æ³•è¼‰å…¥å­—ç¢¼è¡¨');
                }
                
                const text = await response.text();
                const lines = text.split('\n');
                
                charMap = {};
                for (let line of lines) {
                    // å…ˆç§»é™¤å¯èƒ½çš„BOMæ¨™è¨˜ï¼ˆåœ¨trimä¹‹å‰æª¢æŸ¥ï¼‰
                    if (line.length > 0 && line.charCodeAt(0) === 0xFEFF) {
                        line = line.substring(1);
                    }
                    
                    line = line.trim();
                    if (!line) continue;
                    
                    // æŸ¥æ‰¾Tabä½ç½®
                    const tabPos = line.indexOf('\t');
                    if (tabPos > 0 && tabPos < line.length - 1) {
                        const chinese = line.substring(0, tabPos).trim();
                        const uiojk = line.substring(tabPos + 1).trim();
                        // ç§»é™¤uiojkä¸­å¯èƒ½çš„æ›è¡Œç¬¦å’Œå›è»Šç¬¦
                        const cleanUiojk = uiojk.replace(/[\r\n]/g, '').trim();
                        if (chinese && cleanUiojk) {
                            charMap[chinese] = cleanUiojk;
                        }
                    }
                }
                
                const charCount = Object.keys(charMap).length;
                statusDiv.textContent = `âœ“ å­—ç¢¼è¡¨è¼‰å…¥æˆåŠŸï¼ˆ${charCount} å€‹å­—ç¬¦ï¼‰`;
                statusDiv.className = 'status ready';
                dataLoaded = true;
                
                // æ¸¬è©¦è¼‰å…¥çš„æ•¸æ“šï¼ˆèª¿è©¦ç”¨ï¼Œå¯ä»¥ç§»é™¤ï¼‰
                console.log('è¼‰å…¥çš„å­—ç¬¦æ•¸:', charCount);
                if (charCount > 0) {
                    const testChars = ['çš„', 'ä¸€', 'æ˜¯', 'ä½ '];
                    console.log('æ¸¬è©¦å­—ç¬¦æŸ¥æ‰¾:');
                    for (let testChar of testChars) {
                        if (charMap[testChar]) {
                            console.log(`  ${testChar} => ${charMap[testChar]}`);
                        } else {
                            console.log(`  ${testChar} => æœªæ‰¾åˆ°`);
                        }
                    }
                }
                
                // åˆå§‹åŒ–HanziLookupJS
                initHanziLookup();
            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                statusDiv.textContent = `éŒ¯èª¤ï¼šç„¡æ³•è¼‰å…¥å­—ç¢¼è¡¨ - ${error.message}`;
                statusDiv.className = 'status error';
            }
        }
        
        // åˆå§‹åŒ–HanziLookupJS
        function initHanziLookup() {
            if (typeof HanziLookup === 'undefined') {
                console.warn('HanziLookupJS æœªè¼‰å…¥');
                return;
            }
            
            // åˆå§‹åŒ–æ•¸æ“šæ–‡ä»¶
            HanziLookup.init("mmah", "mmah.json", function(success) {
                if (success) {
                    hanzilookupLoaded = true;
                    matcher = new HanziLookup.Matcher("mmah");
                    
                    // åˆå§‹åŒ–ç¹ªåœ–æ¿ï¼ˆå»¶é²åˆå§‹åŒ–ï¼Œç¢ºä¿DOMå·²æ¸²æŸ“ï¼‰
                    setTimeout(() => {
                        initDrawingBoard();
                    }, 100);
                } else {
                    console.warn('ç„¡æ³•è¼‰å…¥ mmah.jsonï¼Œæ‰‹å¯«åŠŸèƒ½å°‡ä¸å¯ç”¨');
                }
            });
        }
        
        // å³æ™‚è­˜åˆ¥è¨ˆæ™‚å™¨
        let recognitionTimer = null;
        let lastStrokeCount = 0;
        let strokeCheckInterval = null;
        
        // åˆå§‹åŒ–ç¹ªåœ–æ¿ä¸¦è¨­ç½®å³æ™‚è­˜åˆ¥
        function initDrawingBoard() {
            if ($("#drawingBoard").length === 0 || $("#drawingBoard").width() === 0) {
                return;
            }
            
            drawingBoard = new HanziLookup.DrawingBoard($("#drawingBoard"), {
                width: $("#drawingBoard").width(),
                height: 300
            });
            
            // è¨­ç½®å³æ™‚è­˜åˆ¥ï¼ˆç›£è½ç­†åŠƒè®ŠåŒ–ï¼‰
            lastStrokeCount = 0;
            
            // æ¸…é™¤ä¹‹å‰çš„æª¢æŸ¥è¨ˆæ™‚å™¨
            if (strokeCheckInterval) {
                clearInterval(strokeCheckInterval);
            }
            
            // ä½¿ç”¨å®šæ™‚æª¢æŸ¥ç­†åŠƒæ•¸é‡è®ŠåŒ–
            strokeCheckInterval = setInterval(() => {
                if (drawingBoard && matcher && hanzilookupLoaded) {
                    try {
                        const strokes = drawingBoard.cloneStrokes();
                        const currentStrokeCount = strokes ? strokes.length : 0;
                        
                        // å¦‚æœç­†åŠƒæ•¸é‡å¢åŠ ï¼Œèªªæ˜ç”¨æˆ¶å®Œæˆäº†æ–°çš„ä¸€ç­†
                        if (currentStrokeCount > lastStrokeCount) {
                            lastStrokeCount = currentStrokeCount;
                            
                            // æ¸…é™¤ä¹‹å‰çš„è­˜åˆ¥è¨ˆæ™‚å™¨
                            if (recognitionTimer) {
                                clearTimeout(recognitionTimer);
                            }
                            
                            // å»¶é²500mså¾Œè­˜åˆ¥ï¼ˆçµ¦ç”¨æˆ¶æ™‚é–“ç¹¼çºŒæ›¸å¯«ä¸‹ä¸€ç­†ï¼‰
                            recognitionTimer = setTimeout(() => {
                                recognizeHandwriting();
                            }, 500);
                        }
                    } catch (e) {
                        console.error('æª¢æŸ¥ç­†åŠƒæ™‚å‡ºéŒ¯:', e);
                    }
                }
            }, 200);
            
            // ç›£è½ç•«å¸ƒçš„é¼ æ¨™/è§¸æ‘¸äº‹ä»¶ä¾†è§¸ç™¼è­˜åˆ¥
            const boardElement = $("#drawingBoard");
            const canvas = boardElement.find('canvas')[0];
            if (canvas) {
                // ç•¶é¼ æ¨™æŠ¬èµ·æ™‚ï¼ˆå®Œæˆä¸€ç­†ï¼‰
                $(canvas).on('mouseup touchend', function() {
                    if (recognitionTimer) {
                        clearTimeout(recognitionTimer);
                    }
                    // å»¶é²300mså¾Œè­˜åˆ¥
                    recognitionTimer = setTimeout(() => {
                        recognizeHandwriting();
                    }, 300);
                });
            }
            
            updateUndoButton();
        }
        
        // æŸ¥æ‰¾å­—ç¬¦å°æ‡‰çš„UIOJK
        function findUIOJK(chinese) {
            let result = [];
            for (let c of chinese) {
                if (charMap[c]) {
                    result.push({
                        char: c,
                        uiojk: charMap[c]
                    });
                } else {
                    result.push({
                        char: c,
                        uiojk: null
                    });
                }
            }
            return result;
        }
        
        // æ›´æ–°è¼¸å‡ºé¡¯ç¤º
        function updateOutput(chinese) {
            const outputDiv = document.getElementById('outputResult');
            
            if (!chinese || chinese.trim() === '') {
                outputDiv.textContent = 'è«‹åœ¨å·¦å´è¼¸å…¥ä¸­æ–‡å­—...';
                return;
            }
            
            // ç¢ºä¿å­—ç¬¦æ˜ å°„è¡¨å·²è¼‰å…¥
            if (Object.keys(charMap).length === 0) {
                outputDiv.innerHTML = '<div style="color: #dc3545; padding: 20px;">å­—ç¢¼è¡¨å°šæœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™...</div>';
                return;
            }
            
            const results = findUIOJK(chinese);
            
            if (results.length === 0) {
                outputDiv.innerHTML = '<div style="padding: 20px;">æœªæ‰¾åˆ°ä»»ä½•çµæœ</div>';
                return;
            }
            
            let html = '';
            
            for (let item of results) {
                if (item.uiojk) {
                    const strokes = convertUIOJKToStrokes(item.uiojk);
                    html += `<div class="output-char">
                        <div class="char-title">${item.char}</div>
                        <div class="char-uiojk">UIOJK: ${item.uiojk}</div>
                        <div class="char-strokes">${strokes}</div>
                    </div>`;
                } else {
                    html += `<div class="output-char">
                        <div class="char-title">${item.char}</div>
                        <div class="char-uiojk" style="color: #dc3545;">æœªæ‰¾åˆ°å°æ‡‰çš„ç­†åŠƒç·¨ç¢¼</div>
                    </div>`;
                }
            }
            
            outputDiv.innerHTML = html;
        }
        
        // åˆ‡æ›è¼¸å…¥æ¨¡å¼
        function switchMode(event, mode) {
            // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // å¦‚æœæ²’æœ‰eventï¼Œé€šédata-modeå±¬æ€§æŸ¥æ‰¾
                document.querySelector(`.mode-tab[data-mode="${mode}"]`).classList.add('active');
            }
            
            // é¡¯ç¤ºå°æ‡‰çš„è¼¸å…¥å€åŸŸ
            document.getElementById('keyboardMode').classList.remove('active');
            document.getElementById('handwritingMode').classList.remove('active');
            document.getElementById(mode + 'Mode').classList.add('active');
            
            // å¦‚æœæ˜¯æ‰‹å¯«æ¨¡å¼ä¸”ç¹ªåœ–æ¿æœªåˆå§‹åŒ–ï¼Œå‰‡åˆå§‹åŒ–
            if (mode === 'handwriting' && !drawingBoard && hanzilookupLoaded && typeof HanziLookup !== 'undefined') {
                setTimeout(() => {
                    initDrawingBoard();
                }, 100);
            }
            
            // æ›´æ–°é‡åšæŒ‰éˆ•ç‹€æ…‹
            if (mode === 'handwriting') {
                setTimeout(() => {
                    updateUndoButton();
                }, 200);
            }
        }
        
        // æ¸…é™¤æ‰‹å¯«æ¿
        function clearBoard() {
            if (drawingBoard) {
                drawingBoard.clear();
                const candidatesDiv = document.getElementById('candidatesList');
                candidatesDiv.innerHTML = '<div style="color: #999; padding: 20px; text-align: center;">è«‹åœ¨ä¸Šæ–¹æ›¸å¯«ï¼Œè­˜åˆ¥çµæœæœƒå³æ™‚é¡¯ç¤º</div>';
                updateUndoButton();
            }
        }
        
        // é‡åšï¼ˆæ’¤éŠ·æœ€å¾Œä¸€ç­†ï¼‰
        function undoStroke() {
            if (drawingBoard && typeof drawingBoard.undo === 'function') {
                drawingBoard.undo();
                // å¦‚æœé‚„æœ‰ç­†åŠƒï¼Œé‡æ–°è­˜åˆ¥
                const strokes = drawingBoard.cloneStrokes();
                if (strokes && strokes.length > 0) {
                    recognizeHandwriting();
                } else {
                    const candidatesDiv = document.getElementById('candidatesList');
                    candidatesDiv.innerHTML = '<div style="color: #999; padding: 20px; text-align: center;">è«‹åœ¨ä¸Šæ–¹æ›¸å¯«ï¼Œè­˜åˆ¥çµæœæœƒå³æ™‚é¡¯ç¤º</div>';
                }
                updateUndoButton();
            } else {
                // å¦‚æœ DrawingBoard æ²’æœ‰ undo æ–¹æ³•ï¼Œå˜—è©¦æ‰‹å‹•å¯¦ç¾
                console.warn('DrawingBoard ä¸æ”¯æŒ undo æ–¹æ³•');
            }
        }
        
        // æ›´æ–°é‡åšæŒ‰éˆ•ç‹€æ…‹
        function updateUndoButton() {
            const undoBtn = document.querySelector('.btn-undo');
            if (undoBtn && drawingBoard) {
                const strokes = drawingBoard.cloneStrokes();
                if (strokes && strokes.length > 0) {
                    undoBtn.disabled = false;
                } else {
                    undoBtn.disabled = true;
                }
            }
        }
        
        // è­˜åˆ¥æ‰‹å¯«ï¼ˆå³æ™‚è­˜åˆ¥ï¼‰
        function recognizeHandwriting() {
            if (!drawingBoard || !matcher || !hanzilookupLoaded) {
                return; // ä¸é¡¯ç¤ºéŒ¯èª¤ï¼Œå› ç‚ºå¯èƒ½é‚„åœ¨è¼‰å…¥
            }
            
            const strokes = drawingBoard.cloneStrokes();
            if (!strokes || strokes.length === 0) {
                const candidatesDiv = document.getElementById('candidatesList');
                candidatesDiv.innerHTML = '<div style="color: #999; padding: 20px; text-align: center;">è«‹åœ¨ä¸Šæ–¹æ›¸å¯«ï¼Œè­˜åˆ¥çµæœæœƒå³æ™‚é¡¯ç¤º</div>';
                updateUndoButton();
                return;
            }
            
            const candidatesDiv = document.getElementById('candidatesList');
            candidatesDiv.innerHTML = '<span class="loading"></span> è­˜åˆ¥ä¸­...';
            updateUndoButton();
            
            const analyzedChar = new HanziLookup.AnalyzedCharacter(strokes);
            matcher.match(analyzedChar, 10, function(matches) {
                if (matches && matches.length > 0) {
                    let html = '';
                    for (let match of matches) {
                        const char = match.character;
                        html += `<span class="candidate-item" onclick="selectCandidate('${char}')">${char}</span>`;
                    }
                    candidatesDiv.innerHTML = html;
                } else {
                    candidatesDiv.innerHTML = '<div style="color: #999; padding: 10px;">æœªæ‰¾åˆ°åŒ¹é…çš„å­—ç¬¦ï¼Œè«‹ç¹¼çºŒæ›¸å¯«</div>';
                }
                updateUndoButton();
            });
        }
        
        // é¸æ“‡å€™é¸å­—ç¬¦
        function selectCandidate(char) {
            // å°‡é¸ä¸­çš„å­—ç¬¦æ·»åŠ åˆ°è¼¸å…¥æ¡†
            const input = document.getElementById('textInput');
            input.value += char;
            input.focus();
            
            // è§¸ç™¼è¼¸å…¥äº‹ä»¶ä»¥æ›´æ–°è¼¸å‡º
            const event = new Event('input', { bubbles: true });
            input.dispatchEvent(event);
            
            // æ¸…é™¤æ‰‹å¯«æ¿
            clearBoard();
        }
        
        // åˆå§‹åŒ–
        $(document).ready(function() {
            // è¼‰å…¥å­—ç¢¼è¡¨
            loadCharData();
            
            // ç›£è½è¼¸å…¥æ¡†è®ŠåŒ–
            $('#textInput').on('input', function() {
                updateOutput($(this).val());
            });
        });
    </script>
</body>
</html>

