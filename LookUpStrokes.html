<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹å¯«è¼¸å…¥ - ä¸­æ–‡ç­†åŠƒæŸ¥æ‰¾å™¨</title>
    
    <!-- å¼•å…¥ jQuery (HanziLookupJS çš„ DrawingBoard éœ€è¦) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- å¼•å…¥ HanziLookupJS åº« -->
    <!-- æ³¨æ„ï¼šéœ€è¦ä¸‹è¼‰ hanzilookup.min.js å’Œæ•¸æ“šæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œæˆ–ä½¿ç”¨ CDN -->
    <!-- å¯ä»¥å¾ https://github.com/gugray/HanziLookupJS ä¸‹è¼‰ -->
    <script src="hanzilookup.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 20px;
            font-family: "Microsoft YaHei", "å¾®è»Ÿé›…é»‘", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
        }
        #drawingBoard {
            border: 3px solid #667eea;
            background: white;
            border-radius: 10px;
            margin: 0 auto;
            display: block;
            width: 400px;
            height: 300px;
        }
        #drawingBoard canvas {
            border-radius: 10px;
        }
        .controls {
            text-align: center;
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-family: "Microsoft YaHei", sans-serif;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-clear {
            background: #ff6b6b;
            color: white;
        }
        .btn-clear:hover {
            background: #ee5a52;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-recognize {
            background: #51cf66;
            color: white;
        }
        .btn-recognize:hover {
            background: #40c057;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-copy {
            background: #4dabf7;
            color: white;
        }
        .btn-copy:hover {
            background: #339af0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .candidates {
            margin-top: 10px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            min-height: 60px;
            text-align: center;
        }
        .candidate-item {
            display: inline-block;
            margin: 8px;
            padding: 12px 20px;
            background: #e7f5ff;
            border: 2px solid #4dabf7;
            border-radius: 8px;
            cursor: pointer;
            font-size: 32px;
            transition: all 0.2s;
            user-select: none;
        }
        .candidate-item:hover {
            background: #4dabf7;
            color: white;
            transform: scale(1.1);
        }
        .selected-char {
            font-size: 48px;
            text-align: center;
            padding: 20px;
            background: #d4edda;
            border: 3px solid #51cf66;
            border-radius: 8px;
            color: #155724;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .hint {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-top: 15px;
            padding: 10px;
            background: #e7f5ff;
            border-radius: 5px;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background: #d1ecf1;
            border-radius: 8px;
            border-left: 4px solid #0c5460;
            font-size: 13px;
            color: #0c5460;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status {
            text-align: center;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 14px;
        }
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        .status.ready {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœï¸ ä¸­æ–‡æ‰‹å¯«è¼¸å…¥</h1>
        
        <div id="status" class="status loading">æ­£åœ¨è¼‰å…¥è­˜åˆ¥åº«...</div>
        
        <div id="drawingBoard"></div>
        
        <div class="controls">
            <button class="btn-clear" onclick="clearBoard()">æ¸…é™¤</button>
            <button class="btn-recognize" onclick="recognize()">è­˜åˆ¥</button>
            <button class="btn-copy" onclick="copySelected()">è¤‡è£½é¸ä¸­å­—ç¬¦</button>
        </div>
        
        <div class="result-area">
            <div class="result-label">è­˜åˆ¥çµæœï¼ˆé»æ“Šå­—ç¬¦é¸æ“‡ï¼‰ï¼š</div>
            <div id="selectedChar" class="selected-char" style="display: none;"></div>
            <div class="candidates" id="candidates">
                <div style="color: #999; padding: 20px;">è«‹åœ¨ä¸Šæ–¹å€åŸŸæ‰‹å¯«è¼¸å…¥ï¼Œç„¶å¾Œé»æ“Šã€Œè­˜åˆ¥ã€</div>
            </div>
        </div>
        
        <div class="hint">
            ğŸ’¡ æç¤ºï¼šæ‰‹å¯«å®Œæˆå¾Œé»æ“Šã€Œè­˜åˆ¥ã€ï¼Œç„¶å¾Œé»æ“Šå€™é¸å­—ç¬¦é¸æ“‡ï¼Œæœ€å¾Œé»æ“Šã€Œè¤‡è£½é¸ä¸­å­—ç¬¦ã€åˆ°ä¸»ç¨‹åº
        </div>
        
        <div class="info">
            <strong>ğŸ“ ä½¿ç”¨èªªæ˜ï¼š</strong><br>
            1. åœ¨ç•«å¸ƒä¸Šä½¿ç”¨æ»‘é¼ æˆ–è§¸æ§ç­†æ›¸å¯«ä¸­æ–‡å­—<br>
            2. æ›¸å¯«å®Œæˆå¾Œé»æ“Šã€Œè­˜åˆ¥ã€æŒ‰éˆ•<br>
            3. è­˜åˆ¥çµæœæœƒé¡¯ç¤ºå€™é¸å­—ç¬¦åˆ—è¡¨<br>
            4. é»æ“Šå€™é¸å­—ç¬¦é€²è¡Œé¸æ“‡<br>
            5. é»æ“Šã€Œè¤‡è£½é¸ä¸­å­—ç¬¦ã€è¤‡è£½åˆ°å‰ªè²¼æ¿<br>
            6. å°‡è¤‡è£½çš„å­—ç¬¦ç²˜è²¼åˆ°ä¸»ç¨‹åºçš„è¼¸å…¥æ¡†ä¸­æŸ¥æ‰¾ç­†åŠƒ
        </div>
    </div>

    <script>
        let drawingBoard = null;
        let matcher = null;
        let selectedCharacter = '';
        let dataLoaded = false;

        // åˆå§‹åŒ– HanziLookupJS
        $(document).ready(function() {
            // æª¢æŸ¥ HanziLookupJS æ˜¯å¦å·²è¼‰å…¥
            if (typeof HanziLookup === 'undefined') {
                document.getElementById('status').textContent = 'éŒ¯èª¤ï¼šhanzilookup.min.js æœªè¼‰å…¥';
                document.getElementById('status').className = 'status error';
                return;
            }

            // åˆå§‹åŒ–æ•¸æ“šæ–‡ä»¶ï¼ˆéœ€è¦ä¸‹è¼‰ mmah.json æˆ– orig.json åˆ°æœ¬åœ°ï¼‰
            // æ³¨æ„ï¼šéœ€è¦å°‡æ•¸æ“šæ–‡ä»¶æ”¾åœ¨èˆ‡ HTML æ–‡ä»¶ç›¸åŒçš„ç›®éŒ„ï¼Œæˆ–èª¿æ•´è·¯å¾‘
            HanziLookup.init("mmah", "mmah.json", function(success) {
                if (success) {
                    dataLoaded = true;
                    document.getElementById('status').textContent = 'âœ“ è­˜åˆ¥åº«å·²è¼‰å…¥ï¼Œå¯ä»¥é–‹å§‹æ›¸å¯«';
                    document.getElementById('status').className = 'status ready';
                    
                    // å‰µå»ºè­˜åˆ¥å™¨å¯¦ä¾‹
                    matcher = new HanziLookup.Matcher("mmah");
                    
                    // åˆå§‹åŒ–ç¹ªåœ–æ¿
                    initDrawingBoard();
                } else {
                    const statusDiv = document.getElementById('status');
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = 'éŒ¯èª¤ï¼šç„¡æ³•è¼‰å…¥æ•¸æ“šæ–‡ä»¶ mmah.json<br><br>' +
                        '<strong>è§£æ±ºæ–¹æ³•ï¼š</strong><br>' +
                        'ç€è¦½å™¨ç„¡æ³•ç›´æ¥åŠ è¼‰æœ¬åœ° JSON æ–‡ä»¶ï¼ˆå®‰å…¨é™åˆ¶ï¼‰<br>' +
                        'è«‹ä½¿ç”¨æœ¬åœ°æœå‹™å™¨æ‰“é–‹æ­¤é é¢ï¼š<br><br>' +
                        '1. é‹è¡Œ <code>å•Ÿå‹•æœ¬åœ°æœå‹™å™¨.bat</code><br>' +
                        '2. åœ¨ç€è¦½å™¨ä¸­è¨ªå• <code>http://localhost:8000/handwriting_hanzilookup.html</code><br><br>' +
                        'æˆ–è€…ä½¿ç”¨å…¶ä»–æœ¬åœ°æœå‹™å™¨å·¥å…·ï¼ˆå¦‚ VS Code çš„ Live Serverï¼‰';
                }
            });
        });

        // åˆå§‹åŒ–ç¹ªåœ–æ¿
        function initDrawingBoard() {
            drawingBoard = new HanziLookup.DrawingBoard($("#drawingBoard"), {
                width: 400,
                height: 300
            });
        }

        // æ¸…é™¤ç¹ªåœ–æ¿
        function clearBoard() {
            if (drawingBoard) {
                drawingBoard.clear();
                document.getElementById('candidates').innerHTML = '<div style="color: #999; padding: 20px;">è«‹åœ¨ä¸Šæ–¹å€åŸŸæ‰‹å¯«è¼¸å…¥ï¼Œç„¶å¾Œé»æ“Šã€Œè­˜åˆ¥ã€</div>';
                document.getElementById('selectedChar').style.display = 'none';
                selectedCharacter = '';
            }
        }

        // è­˜åˆ¥åŠŸèƒ½
        function recognize() {
            if (!drawingBoard || !matcher || !dataLoaded) {
                alert('è­˜åˆ¥åº«æœªè¼‰å…¥å®Œæˆï¼Œè«‹ç¨å€™...');
                return;
            }

            const strokes = drawingBoard.cloneStrokes();
            if (!strokes || strokes.length === 0) {
                alert('è«‹å…ˆæ›¸å¯«ä¸€äº›å…§å®¹');
                return;
            }

            const candidatesDiv = document.getElementById('candidates');
            candidatesDiv.innerHTML = '<div style="padding: 20px;"><span class="loading"></span> è­˜åˆ¥ä¸­...</div>';

            // åˆ†æå­—ç¬¦
            const analyzedChar = new HanziLookup.AnalyzedCharacter(strokes);
            
            // æŸ¥æ‰¾åŒ¹é…ï¼ˆè¿”å›å‰10å€‹å€™é¸ï¼‰
            matcher.match(analyzedChar, 10, function(matches) {
                if (matches && matches.length > 0) {
                    displayCandidates(matches);
                } else {
                    candidatesDiv.innerHTML = '<div style="color: #999; padding: 20px;">æœªæ‰¾åˆ°åŒ¹é…çš„å­—ç¬¦ï¼Œè«‹é‡æ–°æ›¸å¯«</div>';
                }
            });
        }

        // é¡¯ç¤ºå€™é¸å­—ç¬¦
        function displayCandidates(matches) {
            const candidatesDiv = document.getElementById('candidates');
            let html = '';
            
            for (let i = 0; i < matches.length; i++) {
                const char = matches[i].character;
                html += `<span class="candidate-item" onclick="selectCharacter('${char}')">${char}</span>`;
            }
            
            candidatesDiv.innerHTML = html;
        }

        // é¸æ“‡å­—ç¬¦
        function selectCharacter(char) {
            selectedCharacter = char;
            const selectedDiv = document.getElementById('selectedChar');
            selectedDiv.textContent = char;
            selectedDiv.style.display = 'block';
            
            // é«˜äº®é¸ä¸­çš„å€™é¸é …
            const items = document.querySelectorAll('.candidate-item');
            items.forEach(item => {
                if (item.textContent === char) {
                    item.style.background = '#51cf66';
                    item.style.color = 'white';
                    item.style.borderColor = '#51cf66';
                } else {
                    item.style.background = '#e7f5ff';
                    item.style.color = '#333';
                    item.style.borderColor = '#4dabf7';
                }
            });
        }

        // è¤‡è£½é¸ä¸­çš„å­—ç¬¦
        function copySelected() {
            if (!selectedCharacter) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹å­—ç¬¦');
                return;
            }

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(selectedCharacter).then(() => {
                    const selectedDiv = document.getElementById('selectedChar');
                    const originalText = selectedDiv.textContent;
                    selectedDiv.textContent = 'âœ“ å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼';
                    selectedDiv.style.background = '#d4edda';
                    setTimeout(() => {
                        selectedDiv.textContent = originalText;
                        selectedDiv.style.background = '#d4edda';
                    }, 1500);
                }).catch(err => {
                    alert('è¤‡è£½å¤±æ•—ï¼š' + err);
                });
            } else {
                // é™ç´šæ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = selectedCharacter;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const selectedDiv = document.getElementById('selectedChar');
                    const originalText = selectedDiv.textContent;
                    selectedDiv.textContent = 'âœ“ å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼';
                    selectedDiv.style.background = '#d4edda';
                    setTimeout(() => {
                        selectedDiv.textContent = originalText;
                        selectedDiv.style.background = '#d4edda';
                    }, 1500);
                } catch (err) {
                    alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡æ–‡æœ¬è¤‡è£½');
                }
                document.body.removeChild(textArea);
            }
        }
    </script>
</body>
</html>

